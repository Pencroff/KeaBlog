@model KeaBlog.Areas.Admin.Models.PostViewModel

@{
    ViewBag.Title = "Edit";
}

<h2>Edit @Model.Title</h2>

@using (Html.BeginForm("Edit", "Blog", FormMethod.Post, new { @class = "well form-horizontal" }))
{
    @Html.ValidationSummary(true)

    <fieldset>
        <legend class="span3">Post</legend>

        @Html.HiddenFor(model => model.Id)
        @Html.HiddenFor(model => model.AuthorId)        
        @Html.HiddenFor(model => model.Modified)
        @Html.HiddenFor(model => model.Visible)
        
        <div class="span6 offset1">
            <div class="control-group">
                <label class = "control-label" for = "inputModified">Publish in </label>
                <div class="controls">
                    <div class="input-append">
                        <input type="text" class="input-medium" placeholder="Date" id="PublishDate" size="16" 
                               value="@Model.GetModifiedDate()" data-format="dd.mm.yyyy"><span class="add-on"><i class="icon-calendar"></i></span>
                    </div>
                    <div class="input-append">
                        <input type="text" class="input-small" placeholder="Time" id="PublishTime" size="16" value="@Model.GetModifiedTime()"><span class="add-on"><i class="icon-time"></i></span>
                    </div>
                    <p class="help-block">Date and time publish</p>
                </div> 
            </div>
        </div>
        <button class="btn" id="BtnVisible" type="button" value="@Model.Visible.ToString()" btntext = "Опубликовать " trueIcon = "<i class='icon-ok icon-white'>" falseIcon = "<i class='icon-remove'></i>"></button>
        <div class="control-group">
            <label class = "control-label" for = "inputTitle">Title</label>
            <div class="controls">
                @Html.TextBoxFor(model => model.Title, new { @class = "input-xlarge span10", id = "inputTitle" })
                @Html.ValidationMessageFor(model => model.Title)
                <p class="help-block">Title of article</p>
            </div>
        </div>
        <div class="control-group">
            <label class = "control-label" for = "inputUrl">Friendly Url</label>
            <div class="controls">
                @Html.TextBoxFor(model => model.EntryUrl, new { @class = "input-xlarge span10", id = "inputUrl" })
                @Html.ValidationMessageFor(model => model.EntryUrl)
                <p class="help-block">Friendly Url of article</p>
            </div>
        </div>
        <div class="control-group">
            <label class = "control-label" for = "inputContent">Content</label>
            <div class="controls">
                @Html.TextAreaFor(model => model.FullContent, new { @class = "span10 textarea", id = "inputContent", style = "min-height: 250px" })
                @Html.ValidationMessageFor(model => model.FullContent)
                <p class="help-block">Content of article</p>
            </div>
        </div>
        <div class="control-group">
            <label class = "control-label" for = "inputLink">Link</label>
            <div class="controls">
                <div class="pull-left">
                    @Html.TextBoxFor(model => model.OriginalTitle, new { @class = "span4", id = "inputOriginalTitle" })    
                    @Html.ValidationMessageFor(model => model.OriginalTitle)
                    <p class="help-block">Title of link (for translate)</p>
                </div>
                <div class="pull-right">
                    @Html.TextBoxFor(model => model.LinkToOriginal, new { @class = "span6", id = "inputLinkToOriginal" })
                    @Html.ValidationMessageFor(model => model.LinkToOriginal)
                    <p class="help-block">Url on original</p>
                </div>
            </div>
        </div> 
        <div class="control-group">
            <label class = "control-label" for = "inputSEODescription">SEO</label>
            <div class="controls">
                <div class="pull-left">
                    @Html.TextAreaFor(model => model.SEODescription, new { @class = "span5", id = "inputSEODescription" })    
                    @Html.ValidationMessageFor(model => model.SEODescription)
                    <p class="help-block">Article description for Head</p>
                </div>
                <div class="pull-right">
                    @Html.TextAreaFor(model => model.SEOKeywords, new { @class = "span5", id = "inputSEOKeywords" })
                    @Html.ValidationMessageFor(model => model.SEOKeywords)
                    <p class="help-block">Article keywords for Head</p>
                </div>
                
            </div>
        </div> 
        <div class="pull-left">
            <a href='@Url.Action("Index", "Blog")' class = "btn btn-info"><i class="icon-arrow-left icon-white"></i> back to list</a>
        </div>
        <div class="pull-right">
            <input type="submit" value="Save" class="btn btn-primary"/>
        </div>
    </fieldset>
}

@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/wysibb")
    <script>
        var myOpt = {
            debug: false,
            watchTxtArea: false,
            smileAutoDetect: false,
            autoResize: false,
            themeName: 'default',
            themePrefix: '/Content/WysiBB/themes'
            },
            setVisible = function (value, element) {
                var text = element.attr('btntext'),
                    trueIcon = element.attr('trueIcon'),
                    falseIcon = element.attr('falseIcon');
                element.attr('value', value);
                if (value == "true") {
                    element.html(text + trueIcon);
                    element.attr('class', "btn btn-success active");
                } else {
                    element.html(text + falseIcon);
                    element.attr('class', "btn");
                }
                $('#Visible').attr('value', value);
            },
            toogleVisible = function () {
                var element = $("#BtnVisible"),
                    value = element.attr('value').toLowerCase();
                if (value == 'true') {
                    setVisible("false", element);
                } else {
                    setVisible("true", element);
                }
            },
            checkVisible = function () {
                var element = $('#BtnVisible'),
                    value = element.attr('value').toLowerCase();
                setVisible(value, element);
            },
            changeDateTime = function (event) {
                var date = $("#PublishDate").val(),
                    time = $("#PublishTime").val(),
                    datetime = date + " " + time;
                $("#Modified").val(datetime);
            };
            $(document).ready(function () {
                $('#BtnVisible').click(toogleVisible);
                $('#inputContent').wysibb(myOpt);
                $('#PublishTime').timepicker({
                    defaultTime: 'value',
                    minuteStep: 15,
                    disableFocus: false,
                    template: 'dropdown',
                    showSeconds: false,
                    showMeridian: false
                }).on('changeTime', changeDateTime); ;
                $('#PublishDate').datepicker({
                    format: 'dd.mm.yyyy',
                    autoclose: true,
                    language:'ru',
                    weekStart: 1 // Monday
                }).on('changeDate', changeDateTime);
                checkVisible();
            });
    </script>
}
